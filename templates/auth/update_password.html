{% extends "loginreg.html" %}
{% block content %}
<style>
    .error-message {
        color: red;
        font-size: 14px;
    }
</style>
<!--add user-->
<div class="col-lg-8 registration">
    <h2>Update password</h2>
    <hr />
    {% for user in users %}
    <form action="/update_password/{{user.customer_id}}" method="POST" class="registration-form" onsubmit="return validateUpdateForm()">
    {% endfor %}
        {% csrf_token %}
        <div class="row">
           
            <div class="col-lg-6 input-group md-form form-sm ">
                {% for user in users %}
             
                <div class="input-group-append">
                    <span class="icon"><i class="fa fa-user mt-2 p-2"></i></span>
                    <input type="text" name="username" id="username" onfocusout="validateUpdateForm()" class="form-control mt-2" placeholder="User Name" value="{{user.username}}" required>
                </div>
                <span class="error-message" id="username-error"></span>
                {% endfor %}

                <div class="input-group-append">
                    <span class="icon"><i class="fa fa-lock" aria-hidden="true" style="margin-left:10px; margin-top:10px;"></i></span>
                    <input type="password" name="password" id="password" class="form-control mt-2" placeholder="Password">
                </div>
                <span class="error-message" id="password-error"></span>
            </div>
            <div class="col-lg-6 input-group md-form form-sm ">
                <div class="input-group-append">
                    <span class="icon"><i class="fa fa-lock" aria-hidden="true"  style="margin-left:10px; margin-top:10px;"></i></span>
                    <input type="password" name="customer_cpass" id="user_cpass" class="form-control mt-2" placeholder="Confirm Password" >
                </div>
                <span class="error-message" id="confirm-password-error"></span>
            </div>
        </div>
        <!--Buttons -->
        <div class="row d-flex justify-content-center">
            <div class="col-sm-6 btn-group m-3">
                <button type="submit" class="btn btn-outline-success ml-5"><b>Update12</b></button>
            </div>
        </div>
    </form>
</div>

<script>
function validateUpdateForm() {
    var isValid = true;

    // Reset previous error messages
    var errorSpans = document.querySelectorAll(".error-message");
    errorSpans.forEach(function(span) {
        span.textContent = "";
    });

    var password = document.getElementById("password");
    if (password.value.trim() === "") {
        document.getElementById("password-error").textContent = "Password is required.";
        isValid = false;
    } else if (password.value.length < 8 || password.value.length > 12) {
        document.getElementById("password-error").textContent = "Password should be 8 to 12 characters long.";
        isValid = false;
    } else if (!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]+$/.test(password.value)) {
        document.getElementById("password-error").textContent = "Password should include at least one uppercase letter, one lowercase letter, one number, and one special character.";
        isValid = false;
    } else if (password.value.includes(username.value) || password.value.includes(phone.value)) {
        document.getElementById("password-error").textContent = "Avoid using personal information in the password.";
        isValid = false;
    }

    var confirmPassword = document.getElementById("user_cpass");
    if (confirmPassword.value.trim() === "") {
        document.getElementById("confirm-password-error").textContent = "Confirm Password is required.";
        isValid = false;
    } else if (password.value !== confirmPassword.value) {
        document.getElementById("confirm-password-error").textContent = "Passwords do not match.";
        isValid = false;
    }

    return isValid;
}
</script>

{% endblock %}
